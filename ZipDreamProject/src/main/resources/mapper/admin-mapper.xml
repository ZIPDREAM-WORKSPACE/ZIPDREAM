<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="admin-mapper">
	
	<resultMap type="memberApply" id="memberApplyResultSet">
		<result column="USER_NAME" property="userName"/>
		<result column="APPLY_DATETIME" property="applyDateTime"/>
	</resultMap>	
	
	<select id="countUser" resultType="_int">
		SELECT COUNT(*) FROM USER.MEMBER WHERE LICENSE_INT IS NULL AND STATUS = 'Y'
	</select>
	
	<select id="countUserYesterday" resultType="_int">
		SELECT COUNT(*) FROM USER.MEMBER 
		<![CDATA[WHERE LICENSE_INT IS NULL AND STATUS = 'Y' AND ENROLL_DATETIME <= (CURDATE() - INTERVAL 1 DAY)]]>
	</select>
	
	<select id="countLicenseUser" resultType="_int">
		SELECT COUNT(*) FROM USER.MEMBER WHERE LICENSE_INT IS NOT NULL AND STATUS = 'Y'
	</select>
	
	<select id="countLicenseUserYesterday" resultType="_int">
		SELECT COUNT(*) FROM USER.MEMBER 
		<![CDATA[WHERE LICENSE_INT IS NOT NULL AND STATUS = 'Y' AND ENROLL_DATETIME <= (CURDATE() - INTERVAL 1 DAY)]]>
	</select>
	
	<select id="countObject" resultType="_int">
		SELECT COUNT(*) FROM USER.selldetail
	</select>
	
	<select id="countObjectYesterday" resultType="_int">
		SELECT COUNT(*) FROM USER.selldetail 
		<![CDATA[WHERE SELL_ENROLL_DATETIME <= (CURDATE() - INTERVAL 1 DAY)]]>
	</select>
	
	<select id="countReport" resultType="_int">
		SELECT COUNT(*) FROM USER.REPORT WHERE REPORT_STATUS = 'N'
	</select>
	
	<!-- <select id="countReportYesterday">
		SELECT COUNT(*) FROM USER.REPORT WHERE REPORT_STATUS = 'N' AND
	</select> -->
	
	<select id="countEvent" resultType="_int">
		SELECT COUNT(*) FROM USER.PROMOTION
	</select>
	
	<select id="countEventYesterday" resultType="_int">
		SELECT COUNT(*) FROM USER.PROMOTION 
		<![CDATA[WHERE PROMOTION_START_DATETIME <= (CURDATE() - INTERVAL 1 DAY)]]>
	</select>
	
	<select id="countChatRoom" resultType="_int">
		SELECT COUNT(*) FROM USER.CHAT_ROOM WHERE STATUS = 'Y'
	</select>
	
	<select id="countChattingRoom" resultType="_int">
		SELECT COUNT(*) FROM (
			SELECT CHAT_ROOM_NO , COUNT(*) as 'COUNT' , 'STATUS' 
			FROM USER.CHAT_ROOM_JOIN 
			JOIN USER.CHAT_ROOM USING(CHAT_ROOM_NO) 
			GROUP BY CHAT_ROOM_NO HAVING STATUS = 'Y'
		) C 
		WHERE COUNT > 1
	</select>
	
	<select id="selectApplyListLimit5" resultMap="memberApplyResultSet">
		SELECT USER_NAME, APPLY_DATETIME 
		FROM USER.MEMBER_APPLY 
		JOIN USER.MEMBER ON(USER_NO = REF_UNO) 
		ORDER BY APPLY_DATETIME DESC LIMIT 5
	</select>
</mapper>
